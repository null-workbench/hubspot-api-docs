      - name: Generate index.json
        run: |
          echo '{' > index.json
          echo '  "repo": "null-workbench/hubspot-api-docs",' >> index.json
          echo '  "root": "PublicApiSpecs",' >> index.json
          echo '  "generatedAt": "'"$(date -u +"%Y-%m-%dT%H:%M:%SZ")"'",' >> index.json
          echo '  "files": [' >> index.json

          first=true
          find PublicApiSpecs -type f -name "*.json" | sort | while read file; do
            if [ "$first" = true ]; then
              first=false
            else
              echo ',' >> index.json
            fi

            area=$(echo "$file" | cut -d'/' -f2)
            version=$(echo "$file" | grep -o '/v[0-9]\+' | head -n1 | tr -d '/')

            # Build keywords from the file path (folder + filename tokens)
            # - split on / and spaces and underscores and dashes and ampersands
            # - lowercase
            # - drop obvious noise
            kw=$(echo "$file" \
              | sed 's|PublicApiSpecs/||g' \
              | tr '/ _-&' '\n' \
              | tr '[:upper:]' '[:lower:]' \
              | sed '/^$/d' \
              | sed '/^v[0-9]\+$/d' \
              | sed '/^rollouts$/d' \
              | sed '/^[0-9]\+$/d' \
              | sed '/^collection$/d' \
              | sed '/^directory$/d' \
              | sed '/^publicapispecs$/d' \
              | sort -u)

            # Convert keywords lines to JSON array
            keywords_json=$(printf '%s\n' "$kw" | awk 'BEGIN{ORS=""; first=1} {gsub(/"/,"\\\""); if(first){printf "\"%s\"", $0; first=0}else{printf ",\"%s\"", $0}}')

            echo "    {" >> index.json
            echo "      \"path\": \"$file\"," >> index.json
            echo "      \"area\": \"$area\"," >> index.json
            echo "      \"version\": \"${version:-unknown}\"," >> index.json
            echo "      \"keywords\": [${keywords_json}]" >> index.json
            echo "    }" >> index.json
          done

          echo '' >> index.json
          echo '  ]' >> index.json
          echo '}' >> index.json
